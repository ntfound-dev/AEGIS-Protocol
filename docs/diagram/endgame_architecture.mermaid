graph LR
    %% --- Subgraph 1: Ekosistem Eksternal ---
    subgraph Eksternal["ðŸŒ Ekosistem Eksternal & Aktor Global"]
        A1[Berbagai Sumber Data Global (API, Satelit, IoT)]
        U1[Komunitas Global (Donatur, Relawan)]
        U2[Organisasi Bantuan Terakreditasi (NGOs, Tim Medis)]
        I1[Penyedia Asuransi & Likuiditas]
    end

    %% --- Subgraph 2: Fetch.ai Layer ---
    subgraph FetchAI["ðŸ¤– Lapisan Intelijen Terdesentralisasi"]
        B1(Jaringan Oracle Terdesentralisasi - DON)
        B2(Jaringan Validator AI - AI Validator Network)
        B3(Kawanan Agen Aksi - Swarm of Action Agents)
        T1{{Tokenomics AEGIS (Rewards & Slashing)}}
    end

    %% --- Subgraph 3: ICP Layer ---
    subgraph ICP["â›“ Lapisan Kepercayaan & Eksekusi Cerdas (ICP)"]
        C1{{Registry & Governance Core}}
        C2{{EventFactory Canister}}
        C3{{DID & SBT Ledger - Identitas & Reputasi}}
        C4{{Parametric Insurance Vault}}
        
        subgraph EventDAO["ðŸ—³ Event DAO: Gempa Haiti (Canister Instance)"]
            D1[(Treasury & Donation Vault)]
            D2[(Governance Module & Voting)]
            D3[(Needs & Logistics Marketplace)]
        end
    end

    %% --- Alur Logika ---
    A1 -- Data Mentah --> B1
    B1 -- Laporan Terstruktur --> B2
    B1 -- Imbalan --> T1
    B2 -- Konsensus --> B3
    B2 -- Imbalan / Slashing --> T1

    B3 -- "1. declare_event" --> C2
    C2 -- "2. Deploy DAO" --> D1 & D2 & D3

    I1 -- Mendanai --> C4
    C4 -- "3. Dana Otomatis" --> D1

    U1 & U2 -- "4. Bergabung / Partisipasi" --> D2
    U1 -- Donasi --> D1
    U2 -- Proposal --> D3

    D2 -- "5. Voting" --> U1 & U2
    D1 -- "6. Cairkan Dana" --> U2
    D2 -- "7. mint_sbt" --> C3
    C3 -- Lencana Reputasi --> U1 & U2

    %% --- Styling ---
    classDef eksternal fill:#FFF3E0,stroke:#EF6C00,stroke-width:2px;
    classDef fetch fill:#E3F2FD,stroke:#1565C0,stroke-width:2px;
    classDef icp fill:#E8F5E9,stroke:#2E7D32,stroke-width:2px;

    class A1,U1,U2,I1 eksternal
    class B1,B2,B3,T1 fetch
    class C1,C2,C3,C4,D1,D2,D3 icp
